from typing import Any

import pytest
from django.utils import translation

from backend.utils.format_number import intword


@pytest.mark.parametrize(
    "language,value_expected_list",
    [
        (
            "en-us",
            [
                (9.9, "9.9"),
                (999, "999"),
                (1000, "1K"),
                (1200, "1.2K"),
                (1230, "1.23K"),
                (1235, "1.24K"),
                (1000000, "1M"),
                (1200000, "1.2M"),
                (1230000, "1.23M"),
                (1235000, "1.24M"),
                (1000000000, "1B"),
                (1200000000, "1.2B"),
                (1230000000, "1.23B"),
                (1235000000, "1.24B"),
                (1000000000000, "1T"),
                (1200000000000, "1.2T"),
                (1230000000000, "1.23T"),
                (1235000000000, "1.24T"),
                (None, "0"),
                ("invalid", "invalid"),
            ],
        ),
        (
            "zh-hans",
            [
                (9.9, "9.9"),
                (999, "999"),
                (10000, "1万"),
                (12000, "1.2万"),
                (12300, "1.23万"),
                (12350, "1.24万"),
                (100000000, "1亿"),
                (120000000, "1.2亿"),
                (123000000, "1.23亿"),
                (123500000, "1.24亿"),
                (1000000000000, "1兆"),
                (1200000000000, "1.2兆"),
                (1230000000000, "1.23兆"),
                (1235000000000, "1.24兆"),
                (10000000000000000, "1京"),
                (12000000000000000, "1.2京"),
                (12300000000000000, "1.23京"),
                (12350000000000000, "1.24京"),
            ],
        ),
        (
            "zh-hant",
            [
                (9.9, "9.9"),
                (999, "999"),
                (10000, "1萬"),
                (12000, "1.2萬"),
                (12300, "1.23萬"),
                (12350, "1.24萬"),
                (100000000, "1億"),
                (120000000, "1.2億"),
                (123000000, "1.23億"),
                (123500000, "1.24億"),
                (1000000000000, "1兆"),
                (1200000000000, "1.2兆"),
                (1230000000000, "1.23兆"),
                (1235000000000, "1.24兆"),
                (10000000000000000, "1京"),
                (12000000000000000, "1.2京"),
                (12300000000000000, "1.23京"),
                (12350000000000000, "1.24京"),
            ],
        ),
    ],
)
def test_intword(language: str, value_expected_list: list[tuple[Any, str]]):
    with translation.override(language):
        for value, expected in value_expected_list:
            result = intword(value, digits=2)
            message = f"{language=} {value=} {expected=} {result=}"
            assert result == expected, message
